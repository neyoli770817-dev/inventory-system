<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…«æ¯…åº«å­˜ç®¡ç† 4.0 (èªéŸ³ç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --bg-wine: #4A0404; --btn-white: #FFFFFF; --text-dark: #333; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-wine); color: white; margin: 0; padding: 10px; }
        .page { display: none; padding-bottom: 50px; } .page.active { display: block; }
        .header { text-align: center; padding: 15px 0; background: var(--bg-wine); }
        
        .form-container { max-width: 500px; margin: 0 auto 20px auto; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; }
        .form-group { margin-bottom: 12px; position: relative; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; }
        .form-control { width: 100%; padding: 12px; border-radius: 8px; border: none; font-size: 16px; box-sizing: border-box; }
        
        /* èªéŸ³æŒ‰éˆ•æ¨£å¼ */
        .voice-btn { position: absolute; right: 8px; top: 32px; background: #2196F3; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .recording { animation: pulse 1.5s infinite; background: #f44336; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 500px; margin: 0 auto; }
        .menu-item { background: var(--btn-white); aspect-ratio: 1/1; border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .menu-item span { color: var(--text-dark); font-weight: bold; font-size: 18px; margin-top: 10px; }
        
        .item-card { background: white; color: var(--text-dark); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .submit-btn { width: 100%; background: #4CAF50; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 10px; font-size: 16px; }
        .truss-icon { width: 70px; height: auto; }
    </style>
</head>
<body>

    <div id="homePage" class="page active">
        <div class="header"><h1>å…«æ¯…åº«å­˜ 4.0 ğŸ™ï¸</h1></div>
        
        <div class="form-container">
            <div class="form-group">
                <label>å“¡å·¥å§“å</label>
                <select id="userName" class="form-control">
                    <option value="">è«‹é¸æ“‡äººå“¡...</option>
                    <option>é‚±æ­£è±ª</option><option>é‚±å®¥ç‘‹</option><option>å»–æ†å…‰</option>
                    <option>æ—ç¿</option><option>è‘£å¤èˆœ</option><option>é»å…‰åº­</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>å–ç”¨ç›®çš„ / å‚™è¨» (å¯èªéŸ³è¼¸å…¥)</label>
                <input type="text" id="actionPurpose" class="form-control" placeholder="é»æ“Šå³å´éº¥å…‹é¢¨èªªè©±">
                <button type="button" class="voice-btn" id="startVoice">ğŸ¤</button>
            </div>
            
            <p id="voiceStatus" style="font-size: 12px; color: #81D4FA; text-align: center; margin: 0;"></p>
        </div>

        <div class="menu-grid">
            <div class="menu-item" onclick="openCategory('truss')">
                <img src="https://i.imgur.com/K3Vw8Ym.png" class="truss-icon"><span>Trussé¡</span>
            </div>
            <div class="menu-item" onclick="openCategory('tent')">
                <div style="font-size:50px">â›º</div><span>å¸³ç¯·é¡</span>
            </div>
            <div class="menu-item" onclick="alert('æ­£åœ¨å°æ¥ Firebase Storageï¼Œæ­¤åŠŸèƒ½å°‡åœ¨ä¸‹ä¸€ç‰ˆä¸Šç·šï¼')">
                <div style="font-size:50px">ğŸ“»</div><span>èªéŸ³è¨Šæ¯åŒ£</span>
            </div>
        </div>
    </div>

    <div id="listPage" class="page">
        <div class="header">
            <button onclick="showPage('homePage')" style="background:none; border:1px solid white; color:white; padding:8px 15px; border-radius:5px;">â† è¿”å›</button>
            <h2 id="categoryTitle"></h2>
        </div>
        <div id="itemContainer" style="max-width:600px; margin:0 auto;"></div>
    </div>

    <script>
        // 1. Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyBNiATgf4yVR5qZ5CEmGClfm22yjq2fBlI",
            authDomain: "bayi-inventory.firebaseapp.com",
            projectId: "bayi-inventory",
            databaseURL: "https://bayi-inventory-default-rtdb.asia-southeast1.firebasedatabase.app",
            storageBucket: "bayi-inventory.firebasestorage.app",
            messagingSenderId: "494997600674",
            appId: "1:494997600674:web:711588fab8d8ae70eb5afb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. èªéŸ³è¾¨è­˜é‚è¼¯ (Web Speech API)
        const voiceBtn = document.getElementById('startVoice');
        const purposeInput = document.getElementById('actionPurpose');
        const statusText = document.getElementById('voiceStatus');

        if ('webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.continuous = false;

            voiceBtn.onclick = () => {
                recognition.start();
                voiceBtn.classList.add('recording');
                statusText.innerText = "æ­£åœ¨è†è½ä¸­...";
            };

            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                purposeInput.value = result;
                voiceBtn.classList.remove('recording');
                statusText.innerText = "è¾¨è­˜æˆåŠŸï¼";
                // è‡ªå‹•ç™¼é€åˆ° Firebase é€šçŸ¥è€é—†
                sendVoiceNotice(result);
            };

            recognition.onerror = () => {
                voiceBtn.classList.remove('recording');
                statusText.innerText = "èªéŸ³å‡ºéŒ¯ï¼Œè«‹å†è©¦ä¸€æ¬¡";
            };
        } else {
            voiceBtn.style.display = 'none';
            statusText.innerText = "æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥";
        }

        // 3. å³æ™‚ç™¼é€é€šçŸ¥çµ¦æ‚¨
        function sendVoiceNotice(text) {
            const user = document.getElementById('userName').value || "æœªçŸ¥å“¡å·¥";
            db.ref('voice_notices').push({
                user: user,
                message: text,
                time: new Date().toLocaleString()
            });
        }

        // åº«å­˜é‚è¼¯ (èˆ‡ 3.0 ä¸€è‡´)
        const allItems = ["3ç±³Truss", "2ç±³Truss", "1ç±³Truss", "60Truss", "50Truss", "40Truss", "30Truss", "25Truss", "20Truss", "15Truss", "10Truss", "è½‰æ¥é ­", "10Â°ä¸€é«”è½‰æ¥é ­", "15Â°è½‰æ¥é ­", "10Â°è½‰æ¥é ­", "Cå¤¾", "Trusséµæ¿", "3ç±³Trusså¾Œæ’", "2ç±³Trusså¾Œæ’", "70Trusså´æ‹‰", "50Trusså´æ‹‰", "6x6èˆå°æ¿", "3x6èˆå°æ¿", "Layheræ¿", "é›»é¢¨æ‰‡", "åŠæ‰‡", "ä¸‰æ­¥æ¢¯", "ä¸€æ­¥æ¢¯", "åƒåœ¾æ¶", "å¢Šç®±", "12å‘é¦¬æ¤…", "10å‘é¦¬æ¤…", "9å‘é¦¬æ¤…", "8å°ºé¦¬æ¤…", "6å‘é¦¬æ¤…", "5å‘é¦¬æ¤…", "3å‘é¦¬æ¤…", "æ¡Œè»Š", "æ¤…è»Š", "é»‘æ¡Œå·¾", "æ¡Œå·¾", "æœƒè­°æ¡Œæ¡Œå·¾", "æ¤…å¥—", "èˆå°é»‘åœ 15m*90", "èˆå°é»‘åœ 15m*150", "èˆå°é»‘åœ 120m*150", "3ç±³å¿«é€Ÿå¸³(ç´…ç™½)", "3ç±³å¿«é€Ÿå¸³(ç™½)", "3ç±³åœå¸ƒ(ç™½)", "3ç±³åœå¸ƒ(å¤§ç´…)", "3ç±³é ‚ç¯·(ç´…)", "éª¨æ¶300*300", "3ç±³ç‡ˆ", "3ç±³æ°´æº", "å±‹å‹å¸³(ç´…)", "éª¨æ¶300*600", "6ç±³é ‚ç¯·(ç™½)", "6ç±³é ‚ç¯·(ç´…ç™½)", "6ç±³é ‚ç¯·(ç´…)", "6ç±³é ‚ç¯·(é€æ˜)", "éª¨æ¶600*600", "6ç±³æ°´æºå¸ƒ", "6ç±³åœå¸ƒ(ç™½)", "6ç±³é‚Š", "6ç±³è…³", "6ç±³é›çˆª", "6ç±³å¸³ç¯·ç‡ˆ", "ç‡Ÿé‡˜", "12å‘æ‹±", "15å‘æ‹±", "20å‘æ‹±", "24å‘æ‹±", "30å‘æ‹±", "15å‘é ­åœ", "15å‘é ­åœ(ç´…)", "20å‘é ­åœ", "20å‘é ­åœ(ç´…)", "24å‘é ­åœ", "24å‘é ­åœ(ç´…)", "30å‘é ­åœ", "åœ“æ‹±åœå¸ƒ(ç´…)", "12å‘é ‚æ£š(ç™½)", "12å‘é ‚æ£š(ç´…ç™½)", "15å‘é ‚æ£š(ç™½)", "15å‘é ‚æ£š(ç´…ç™½)", "20å‘é ‚æ£š(ç™½)", "20å‘é ‚æ£š(ç´…ç™½)", "24å‘é ‚æ£š(ç™½)", "24å‘é ‚æ£š(ç´…ç™½)", "30å‘é ‚æ£š(ç™½)", "30å‘é ‚æ£š(ç´…ç™½)", "æœƒè­°æ¡Œ", "é»‘é‡‘å‰›", "é»å¿ƒæ¤…", "ç´…é¾", "ä¸‰è§’éŒ", "ä¸‰è§’éŒé€£æ¡¿", "æ²™åŒ…"];
        const categories = { truss: allItems.filter(n => n.includes('Truss')), tent: allItems.filter(n => !n.includes('Truss')) };

        function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function openCategory(cat) {
            document.getElementById('categoryTitle').innerText = (cat === 'truss' ? 'ğŸ—ï¸ Trussé¡' : 'â›º å¸³ç¯·é¡');
            const container = document.getElementById('itemContainer');
            container.innerHTML = '';
            categories[cat].forEach(name => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `<div style="display:flex; justify-content:space-between; color:#333"><b>${name}</b><span id="qty-${name}">0</span></div><div style="margin-top:10px; display:flex; gap:5px;"><input type="number" id="in-${name}" style="flex:1; padding:8px;" placeholder="æ•¸é‡"><button class="submit-btn" onclick="submitChange('${name}')" style="flex:1">é€å‡º</button></div>`;
                container.appendChild(card);
                db.ref('inventory/' + name).on('value', s => { document.getElementById(`qty-${name}`).innerText = s.val() || 0; });
            });
            showPage('listPage');
        }
        function submitChange(name) {
            const user = document.getElementById('userName').value;
            const purpose = document.getElementById('actionPurpose').value;
            const val = parseInt(document.getElementById('in-' + name).value);
            if(!user || isNaN(val)) return alert('è«‹é¸å§“åä¸¦è¼¸å…¥æ•¸é‡');
            db.ref('inventory/' + name).transaction(c => (c || 0) + val);
            db.ref('logs').push({ user, name, val, purpose, time: new Date().toLocaleString() });
            alert('ç´€éŒ„æˆåŠŸ');
        }
    </script>
</body>
</html>
