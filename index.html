<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…«æ¯…åº«å­˜ç®¡ç†ç³»çµ±-å®Œæ•´ä¿®å¾©ç‰ˆ</title>
    <style>
        :root { --bg-wine: #4A0404; --btn-white: #FFFFFF; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-wine); color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        .page { display: none; padding-bottom: 50px; } .page.active { display: block; }
        .form-container { max-width: 500px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; box-sizing: border-box; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 5px; color: #FFD700; font-size: 14px; font-weight: bold; }
        .form-control { width: 100%; padding: 12px; border-radius: 8px; border: none; font-size: 16px; box-sizing: border-box; }
        
        /* èªéŸ³å€å¡Šå„ªåŒ–ï¼šç¢ºä¿æŒ‰éˆ•ä¸è·‘æ‰ */
        .voice-section { display: flex; flex-direction: column; gap: 8px; }
        .voice-row { display: flex; gap: 8px; }
        .voice-input { flex-grow: 1; height: 80px; border-radius: 8px; border: none; padding: 10px; font-size: 16px; color: #333; resize: none; }
        .mic-btn { width: 60px; background: #555; border: none; border-radius: 8px; font-size: 28px; color: white; cursor: pointer; }
        .mic-btn.recording { background: #ff0000; animation: blink 1s infinite; }
        .send-btn-full { width: 100%; padding: 15px; background: #FFD700; color: #333; border: none; border-radius: 8px; font-weight: bold; font-size: 18px; cursor: pointer; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* é¸å–®èˆ‡æ¸…å–® */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 500px; margin: 20px auto; }
        .menu-item { background: var(--btn-white); aspect-ratio: 1/1; border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; color: #333; text-decoration: none; }
        .menu-item img { width: 60px; height: 60px; object-fit: contain; }
        .menu-item span { font-weight: bold; margin-top: 10px; }
        .item-card { background: white; color: #333; border-radius: 12px; padding: 12px; margin-bottom: 10px; }
        .back-btn { background: none; border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin-bottom: 10px; cursor: pointer; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<div id="homePage" class="page active">
    <div style="text-align: center; padding: 10px;"><h2>å…«æ¯…åº«å­˜ç³»çµ±</h2></div>
    <div class="form-container">
        <div class="form-group">
            <label>å“¡å·¥å§“å</label>
            <select id="userName" class="form-control" onchange="localStorage.setItem('bayi_user', this.value)">
                <option value="">è«‹é¸æ“‡...</option>
                <option>é‚±æ­£è±ª</option><option>é‚±å®¥ç‘‹</option><option>å»–æ†å…‰</option><option>æ—ç¿</option><option>è‘£å¤èˆœ</option><option>é»å…‰åº­</option>
            </select>
        </div>
        <div class="form-group"><label>æ—¥æœŸ</label><input type="date" id="actionDate" class="form-control"></div>
        <div class="form-group">
            <label>èªéŸ³å‚™è¨» / å¿«é€Ÿå ±å‚™</label>
            <div class="voice-section">
                <div class="voice-row">
                    <textarea id="eventTag" class="voice-input" placeholder="æŒ‰éº¥å…‹é¢¨èªªè©±..."></textarea>
                    <button id="voiceBtn" class="mic-btn" onclick="toggleSpeech()">ğŸ¤</button>
                </div>
                <button class="send-btn-full" onclick="submitBatch()">ğŸš€ é€å‡ºèªéŸ³å…§å®¹</button>
            </div>
        </div>
    </div>
    <div class="menu-grid">
        <div class="menu-item" onclick="openCat('truss')"><img src="https://i.postimg.cc/GtDsw45n/OIP.png"><span>Trussé¡</span></div>
        <div class="menu-item" onclick="openCat('tent')"><img src="https://i.postimg.cc/KYxJNfXy/3tent001.png"><span>å¸³ç¯·é¡</span></div>
        <div class="menu-item" onclick="showStock()"><div style="font-size:40px">ğŸ“Š</div><span>å³æ™‚åº«å­˜</span></div>
        <div class="menu-item" onclick="openCat('others')"><img src="https://i.postimg.cc/T1pdFnDg/OIP-(1).png"><span>å…¶å®ƒç‰©æ–™</span></div>
    </div>
</div>

<div id="listPage" class="page">
    <div style="padding: 10px;"><button class="back-btn" onclick="showPage('homePage')">â† è¿”å›</button><h2 id="catTitle" style="display:inline; margin-left:15px;"></h2></div>
    <div id="itemContainer" style="max-width:500px; margin: 0 auto;"></div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBNiATgf4yVR5qZ5CEmGClfm22yjq2fBlI", authDomain: "bayi-inventory.firebaseapp.com", projectId: "bayi-inventory", databaseURL: "https://bayi-inventory-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // èªéŸ³ä¿®æ­£
    function voiceFixer(text) {
        let t = text;
        t = t.replace(/[ä¸‰å±±æ‰]ç±³/g, "3ç±³Truss ");
        t = t.replace(/[å…©é‡æ¶¼äº®]ç±³/g, "2ç±³Truss ");
        t = t.replace(/cross|chars|åˆ·|å‰µ|è™•/gi, "Truss");
        return t;
    }

    let recognition;
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.lang = 'zh-TW';
        recognition.onresult = (e) => {
            document.getElementById('eventTag').value += voiceFixer(e.results[0][0].transcript) + " ";
            stopVisuals();
        };
        recognition.onend = stopVisuals;
    }

    function toggleSpeech() {
        const btn = document.getElementById('voiceBtn');
        if (btn.classList.contains('recording')) { recognition.stop(); } 
        else { recognition.start(); btn.classList.add('recording'); btn.innerText = "ğŸ›‘"; }
    }
    function stopVisuals() { const btn = document.getElementById('voiceBtn'); btn.classList.remove('recording'); btn.innerText = "ğŸ¤"; }

    // --- å®Œæ•´æ•‘å› 91 å€‹å“é …æ¸…å–® ---
    const allItems = {
        truss: ["3ç±³Truss", "2ç±³Truss", "1ç±³Truss", "60Truss", "50Truss", "40Truss", "30Truss", "25Truss", "20Truss", "15Truss", "10Truss", "è½‰æ¥é ­", "10Â°ä¸€é«”è½‰æ¥é ­", "15Â°è½‰æ¥é ­", "10Â°è½‰æ¥é ­", "Trusséµæ¿", "Trussæ–œæ’"],
        tent: ["12å‘æ‹±", "15å‘æ‹±", "20å‘æ‹±", "24å‘æ‹±", "30å‘æ‹±", "15å‘é ­åœ", "15å‘é ­åœ(ç´…)", "20å‘é ­åœ", "20å‘é ­åœ(ç´…)", "24å‘é ­åœ", "24å‘é ­åœ(ç´…)", "30å‘é ­åœ", "12å‘é ‚æ£š(ç™½)", "12å‘é ‚æ£š(ç´…ç™½)", "15å‘é ‚æ£š(ç™½)", "15å‘é ‚æ£š(ç´…ç™½)", "20å‘é ‚æ£š(ç™½)", "20å‘é ‚æ£š(ç´…ç™½)", "24å‘é ‚æ£š(ç™½)", "24å‘é ‚æ£š(ç´…ç™½)", "30å‘é ‚æ£š(ç™½)", "30å‘é ‚æ£š(ç´…ç™½)", "3ç±³å¿«é€Ÿå¸³(ç™½)", "3ç±³å¿«é€Ÿå¸³(ç´…ç™½)", "3ç±³åœå¸ƒ(ç™½)", "3ç±³åœå¸ƒ(ç´…)", "3ç±³é ‚ç¯·(ç´…)", "3ç±³å¸³ç¯·ç‡ˆ", "3ç±³æ°´æº", "3ç±³6é ‚æ£š(ç´…)", "6ç±³é ‚ç¯·(ç™½)", "6ç±³é ‚ç¯·(ç´…ç™½)", "6ç±³é ‚ç¯·(ç´…)", "6ç±³é ‚ç¯·(é€æ˜)", "6ç±³æ°´æºå¸ƒ", "6ç±³åœå¸ƒ(ç™½)", "6ç±³å¸³ç¯·ç‡ˆ", "ç‡Ÿé‡˜", "æ²™åŒ…", "éª¨æ¶300*300", "éª¨æ¶300*600", "éª¨æ¶600*600"],
        others: ["6x6èˆå°æ¿", "3x6èˆå°æ¿", "Layheræ¿", "é›»é¢¨æ‰‡", "åŠæ‰‡", "ä¸‰æ­¥æ¢¯", "ä¸€æ­¥æ¢¯", "åƒåœ¾æ¶", "å¢Šç®±", "12å‘é¦¬æ¤…", "9å‘é¦¬æ¤…", "8å°ºé¦¬æ¤…", "5å‘é¦¬æ¤…", "3å‘é¦¬æ¤…", "æœƒè­°æ¡Œæ¡Œå·¾(é»‘145*270)", "æœƒè­°æ¡Œæ¡Œå·¾(ç´…145*270)", "æœƒè­°æ¡Œåšæ¡Œå·¾(ç´…145*270)", "é¦™æª³é‡‘æ¤…å¥—", "èˆå°é»‘åœ 15m*90", "èˆå°é»‘åœ 15m*150", "èˆå°é»‘åœ 120m*150", "æœƒè­°æ¡Œ", "é»‘é‡‘å‰›", "é»å¿ƒæ¤…", "ç´…é¾", "ä¸‰è§’éŒ", "ä¸‰è§’éŒé€£æ¡¿", "Cå¤¾"]
    };

    function openCat(cat) {
        const container = document.getElementById('itemContainer'); container.innerHTML = '';
        document.getElementById('catTitle').innerText = (cat==='truss'?'ğŸ—ï¸ Truss':(cat==='tent'?'â›º å¸³ç¯·':'ğŸ“¦ å…¶å®ƒ'));
        allItems[cat].forEach(name => {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `<div style="display:flex; justify-content:space-between;"><b>${name}</b><span id="st-${name}">...</span></div>
                <div style="display:flex; gap:10px; margin-top:8px;">
                <input type="number" id="in-${name}" style="width:70px; padding:10px; border:1px solid #ccc; border-radius:5px;" placeholder="0">
                <button onclick="updateQty('${name}', 1)" style="flex:1; background:#4CAF50; color:white; border:none; border-radius:5px;">ğŸ“¥å…¥åº«</button>
                <button onclick="updateQty('${name}', -1)" style="flex:1; background:#E91E63; color:white; border:none; border-radius:5px;">ğŸ“¤å‡ºåº«</button>
                </div>`;
            db.ref('inventory/'+name).on('value', s => { if(document.getElementById('st-'+name)) document.getElementById('st-'+name).innerText = s.val()||0; });
            container.appendChild(card);
        });
        showPage('listPage');
    }

    function updateQty(name, dir) {
        const user = document.getElementById('userName').value;
        const val = parseInt(document.getElementById('in-'+name).value);
        if(!user || isNaN(val)) return alert('å¡«äººå“¡èˆ‡æ•¸é‡');
        db.ref('inventory/'+name).transaction(c => (c||0) + (val * dir));
        db.ref('logs').push({ user, name, delta: val*dir, note: document.getElementById('eventTag').value, date: document.getElementById('actionDate').value, time: new Date().toLocaleString() });
        alert('ç´€éŒ„æˆåŠŸ'); document.getElementById('in-'+name).value = '';
    }

    function submitBatch() {
        const user = document.getElementById('userName').value;
        if(!user) return alert('é¸äººå“¡');
        db.ref('logs').push({ user, type: "èªéŸ³", note: document.getElementById('eventTag').value, date: document.getElementById('actionDate').value, time: new Date().toLocaleString() });
        alert('é€å‡ºæˆåŠŸ'); document.getElementById('eventTag').value = '';
    }

    function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    window.onload = () => { 
        document.getElementById('actionDate').valueAsDate = new Date();
        if(localStorage.getItem('bayi_user')) document.getElementById('userName').value = localStorage.getItem('bayi_user'); 
    };
</script>
</body>
</html>
